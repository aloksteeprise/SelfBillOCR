<div class="modal d-block mt-4 custom-height" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
  aria-hidden="false">
  <div class="modal-dialog modal-lg custom-modal-width modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title mx-3 headingmargin" id="exampleModalLabel"
          style="font-size: 22px; font-weight: 700; color: #2f455c;">Self-Bill Invoice Form</h5>
        <button type="button" class="btn-close" (click)="closeDialog()" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex flex-column flex-lg-row">
        <!-- Left Side: Form with Scrollbar -->
        <div class="col-12 col-lg-6 overflow-auto pe-lg-4 mb-2 mb-lg-0"
          style="max-height: 480px; border-right: 5px solid #ddd;">
          <app-notification-popup
          *ngIf="(notificationService.notificationVisibility$ | async)"
        ></app-notification-popup>
        

          <form #myForm="ngForm" (ngSubmit)="onSubmit(myForm)">
            <!-- Contractor Name -->
            <div class="row mb-2 align-items-center">
              <label for="contractorname" class="col-sm-4 col-form-label fontsize14">Contractor Name:
              </label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="ContractorName" name="contractorname"
                  [(ngModel)]="contractorname" #name="ngModel" maxlength="250"  (blur)="onContractorNameBlur()"  appInputSanitizer="alphabet" required>
              </div>
            </div>


            <!-- AFS Contractor DropDown -->
            <!-- <div class="row mb-2 align-items-center">
              <label for="afscontractor" class="col-sm-4 col-form-label fontsize14">AFS Contractor:</label>
              <div class="col-sm-8">
                <select class="form-select" id="AFSContractorDropdown" name="Contractor" (change)="filterContractData()"
                  required [(ngModel)]="selectedContract">
                  <option *ngFor="let option of contractorOptions" [ngValue]="option">
                    {{ option.fullName }}
                  </option>
                </select>
              </div>
            </div> -->

            <div class="row mb-2 align-items-center">
              <label for="afscontractor" class="col-sm-4 col-form-label fontsize14">AFS Contractor: <span style="color: red;"> *</span> </label>
              <div class="col-sm-8">
                <select class="form-select" id="AFSContractorDropdown" name="Contractor" (change)="filterContractData()"
                  required [(ngModel)]="selectedContract">
                  <option [ngValue]="null" disabled selected>Select Contractor</option>
                  <option *ngFor="let option of contractorOptions" [ngValue]="option">
                    {{ option.fullName }}
                  </option>
                </select>
                <div class="error-message" *ngIf="errors.selectedContract">
                  <small class="text-danger" *ngIf="errors.selectedContract">{{ errors.selectedContract }}</small>
                </div>
              </div>
            </div>

            <!-- AFS Contact -->
            <!-- <div class="row mb-2 align-items-center">
              <label for="afscontact" class="col-sm-4 col-form-label fontsize14">AFS Contract:</label>
              <div class="col-sm-8">
                <select class="form-select" id="AFSContactDropdown" name="afscontact" required
                  [(ngModel)]="selectedFilteredContract">
                  <option *ngFor="let option of filteredContractOptions" [value]="option.name">
                    {{ option.name }}
                  </option>
                </select>
              </div>
            </div> -->

            <div class="row mb-2 align-items-center">
              <label for="afscontact" class="col-sm-4 col-form-label fontsize14">AFS Contract <span style="font-size: 13px; color: grey;">(Active Only)</span>: <span style="color: red;"> *</span></label>
              <div class="col-sm-8">
                <select class="form-select" id="AFSContactDropdown" name="afscontact" required
                  [(ngModel)]="selectedFilteredContract">
                  <option [value]="" disabled selected>Select Contract</option>
                  <option *ngFor="let option of filteredContractOptions" [value]="option.name">
                    {{ option.name }}
                  </option>
                </select>
                <div class="error-message" *ngIf="errors.selectedFilteredContract">
                  <small class="text-danger">{{ errors.selectedFilteredContract }}</small>
                </div>
                <div *ngIf="IsContractIsActiveOrNot ==='Contract is not active.'">
                  <span  style="color: rgb(225, 21, 21);"> Contract is not active.</span>
                </div>
              </div>
            </div>

            <!-- First Name -->
            <div class="row mb-2 align-items-center">
              <label for="firstnamefor" class="col-sm-4 col-form-label fontsize14">First Name: <span style="color: red;"> *</span></label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="firstnamefor" name="firstnamefor" [(ngModel)]="firstnamefor"
                  required maxlength="50" (input)="clearValidation('firstName')" appInputSanitizer="alphabet" />
                  <div class="error-message" *ngIf="errors.firstName">
                  <small class="text-danger" *ngIf="errors.firstName">{{ errors.firstName }}</small>
                </div>
              </div>
            </div>

            <!-- Last Name -->
            <div class="row mb-2 align-items-center">
              <label for="lastnamefor" class="col-sm-4 col-form-label fontsize14">Last Name: <span style="color: red;"> *</span></label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="lastnamefor" name="lastnamefor" [(ngModel)]="lastnamefor"
                  required maxlength="50" (input)="clearValidation('lastName')" appInputSanitizer="alphabet" />
                  <div class="error-message" *ngIf="errors.lastName">
                  <small class="text-danger" *ngIf="errors.lastName">{{ errors.lastName }}</small>
                </div>
              </div>
            </div>

            <!-- Start Date -->
            <div class="row mb-2 align-items-center">
              <label for="startDate" class="col-sm-4 col-form-label fontsize14">
                Start Date: <span style="color: red;"> *</span>
              </label>
              <div class="col-sm-8">
                <input type="date" class="form-control" id="startDate" name="startdates" [(ngModel)]="startdate"
                  required (input)="clearValidation('startDate')"  [max]="getToday()"/>
                  <div class="error-message" *ngIf="errors.startDate">
                    <small class="text-danger" *ngIf="errors.startDate">{{ errors.startDate }}</small>
                  </div>
                  <small class="text-danger" *ngIf="errors.dateComparison">{{ errors.dateComparison }}</small>
              </div>
            </div>
            

            <!-- End Date -->
            <div class="row mb-2 align-items-center">
              <label for="endDate" class="col-sm-4 col-form-label fontsize14">End Date: <span style="color: red;"> *</span></label>
              <div class="col-sm-8">
                <input
                  type="date"
                  class="form-control"
                  id="endDate"
                  name="enddates"
                  [(ngModel)]="enddate"
                  (input)="clearValidation('endDate')" 
                   [max]="getToday()"
                />
                <!-- Only show the div if there is an error -->
                <div class="error-message" *ngIf="errors.endDate">
                  <small class="text-danger">{{ errors.endDate }}</small>
                </div>
              </div>
            </div>

            <!-- Total Amount -->
            <div class="row mb-2 align-items-center">
              <label for="TotalAmount" class="col-sm-4 col-form-label fontsize14">Total Amount:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="TotalAmount" name="totalAmount" [(ngModel)]="totalAmount"
                  required maxlength="50" appInputSanitizer="number">
              </div>
            </div>
            <!-- Invoice No -->
            <div class="row mb-2 align-items-center">
              <label for="InvoiceNo" class="col-sm-4 col-form-label fontsize14">Invoice no:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="InvoiceNo" name="invoiceNumber" [(ngModel)]="invoiceNumber"
                  maxlength="500" required appInputSanitizer="alphanumeric">
              </div>
            </div>
            <div class="row mb-2 align-items-center">
              <label for="Invoicedate" class="col-sm-4 col-form-label fontsize14">Invoice Date:</label>
              <div class="col-sm-8">
                <input type="date" class="form-control" id="Invoicedate" name="invoiceDate" required
                  [(ngModel)]="invoiceDate">
                  <div class="error-message" *ngIf="errors.invoiceDate">
                    <small class="text-danger">{{ errors.invoiceDate }}</small>
                  </div>
              </div>
            </div>
            <input type="hidden" id="groupNewId" name="groupNewId" [(ngModel)]="groupNewId">
            <input type="hidden" id="gridCtcCode" name="gridCtcCode" [(ngModel)]="gridCtcCode">
            <input type="hidden"   id="hiddenField"   name="hiddenData"   [(ngModel)]="conCode">
            <div class="loading-overlay" *ngIf="loading">
              <div class="loader"></div>
            </div>
          </form>
        </div>
        <!-- <div class="col-12 col-lg-6 d-flex justify-content-center align-items-center"
          style="max-width: 792px; max-height: 490px; margin-left: 6px;">
          <div class="image-scroll-container overflow-auto" style="max-width: 792px; border: 2px solid #ddd;">
            <lib-ngx-image-zoom *ngIf="thumbImage && fullImagePath" [thumbImage]="thumbImage"
              [fullImage]="fullImagePath" [magnification]="1.5" [enableScrollZoom]="false" [enableLens]="true"
              [lensWidth]="140" [lensHeight]="140" [minZoomRatio]="0.5" [maxZoomRatio]="1" [circularLens]="true"
              [scrollStepSize]="1">
            </lib-ngx-image-zoom>
          </div>
        </div> -->

        <div 
        class="col-12 col-lg-6 d-flex justify-content-center align-items-center"
        style="max-width: 792px; max-height: 490px; margin-left: 6px;"
      >
      <a target="_blank"  style="display: contents;"  href="{{pdfFileName}}" >
        <i 
        class="fa fa-download" 
        style="
     font-size: 20px;
    position: absolute;
    z-index: 10;
    color: #fff;
    top: 1px;
    background: rgba(0, 0, 0, 0.5);
    padding: 5px;
    border-radius: 50%;
    right: 60px;
    background-color: green;"
      ></i>
      </a>


        <div 
          class="image-scroll-container overflow-auto" 
          [ngStyle]="{ 'max-width': imageWidth + 'px', 'max-height': imageHeight + 'px', 'border': '2px solid #ddd' }"
        > 

          <lib-ngx-image-zoom 
            *ngIf="thumbImage && fullImagePath" 
            [thumbImage]="thumbImage"
            [fullImage]="fullImagePath" 
            [magnification]="1.5" 
            [enableScrollZoom]="false" 
            [enableLens]="true"
            [lensWidth]="140" 
            [lensHeight]="140" 
            [minZoomRatio]="0.5" 
            [maxZoomRatio]="1" 
            [circularLens]="true"
            [scrollStepSize]="1"
            (imageLoaded)="onImageLoad($event)"
          >
          </lib-ngx-image-zoom>
        </div>
      </div>
      

      </div>
      <div class="col-12 phoneresponsive">
        <div class="row">
          <!-- Error Message with more space on larger screens -->
          <div class="col-12 col-lg-4">
            <!-- <small class="text-danger p-2" *ngIf="errors.dateComparison">
              {{ errors.dateComparison }}
            </small> -->
          </div>

          <!-- Button on the right -->
          <div class="col-12 col-lg-3 overflow-auto  mb-3 mb-lg-0 d-flex justify-content-start ">
            <button (click)="submitForm()" class="btn btn-primary mt-3 mb-3">Validate and Next</button>
            <button (click)="onSkip()" class="btn btn-outline-dark mt-3 mb-3" style="margin-left: 20px;">Skip</button>
          </div>

          <!-- <div class="col-12 col-lg-3 overflow-auto  mb-3 mb-lg-0 d-flex justify-content-end">
            <i class="fa fa-download" style="font-size:24px; "></i>

          </div> -->

        </div>
      </div>
    </div>
  </div>
</div>